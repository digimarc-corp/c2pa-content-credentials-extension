{"version":3,"file":"build.js","sourceRoot":"","sources":["../build.ts"],"names":[],"mappings":";;;AAAA,+BAA0C;AAC1C,iCAA8C;AAC9C,+CAA6C;AAItC,KAAK,UAAU,KAAK,CAAC,OAAwB;IAClD,MAAM,EAAE,OAAO,EAAE,GAAG,OAAO,CAAC;IAE5B,MAAM,UAAU,GAAG,MAAM,IAAA,0BAAY,EAAC,OAAO,EAAE,OAAO,CAAC,CAAC;IACxD,MAAM,MAAM,GAAG;QACb,GAAG,UAAU;QACb,KAAK,EAAE;YACL,MAAM,EAAE,OAAO,CAAC,SAAS;YACzB,WAAW,EAAE,KAAK;YAClB,SAAS,EAAE,IAAI;SAChB;KACF,CAAC;IAEF,MAAM,WAAW,GAAG,MAAM,OAAO,CAAC,KAAK,CAAC,WAAW,EAAE,MAAM,EAAE,OAAO,CAAC,CAAC;IAEtE,MAAM,OAAO,GAAG,MAAM,OAAO,CAAC,KAAK,CAAmB,KAAK,CAAC,CAAC;IAC7D,0EAA0E;IAC1E,MAAM,IAAI,GAAG,IAAA,2BAAoB,EAAC,OAAO,EAAE,WAAW,CAAC,SAAS,CAAC,CAAC;IAClE,kBAAkB;IAClB,WAAW,CAAC,MAAM,GAAG;QACnB,GAAG,WAAW,CAAC,MAAM;QACrB,GAAG,IAAI;KACR,CAAC;IAEF,MAAM,IAAA,YAAS,EAAC,WAAW,CAAC,CAAC;AAC/B,CAAC;AAzBD,sBAyBC","sourcesContent":["import { build as viteBuild } from 'vite';\nimport { stringifyProcessEnvs } from './envs';\nimport { commonConfig } from './vite-config';\n\nimport type { EnvsRaw, ExtendedOptions } from './types';\n\nexport async function build(options: ExtendedOptions) {\n  const { presets } = options;\n\n  const baseConfig = await commonConfig(options, 'build');\n  const config = {\n    ...baseConfig,\n    build: {\n      outDir: options.outputDir,\n      emptyOutDir: false, // do not clean before running Vite build - Storybook has already added assets in there!\n      sourcemap: true,\n    },\n  };\n\n  const finalConfig = await presets.apply('viteFinal', config, options);\n\n  const envsRaw = await presets.apply<Promise<EnvsRaw>>('env');\n  // Stringify env variables after getting `envPrefix` from the final config\n  const envs = stringifyProcessEnvs(envsRaw, finalConfig.envPrefix);\n  // Update `define`\n  finalConfig.define = {\n    ...finalConfig.define,\n    ...envs,\n  };\n\n  await viteBuild(finalConfig);\n}\n"]}
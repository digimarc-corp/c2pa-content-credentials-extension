{"version":3,"file":"no-fouc.js","sourceRoot":"","sources":["../../plugins/no-fouc.ts"],"names":[],"mappings":";;;AAEA;;;;;;GAMG;AACH,SAAgB,MAAM;IACpB,OAAO;QACL,IAAI,EAAE,SAAS;QACf,OAAO,EAAE,MAAM;QACf,KAAK,CAAC,kBAAkB,CAAC,IAAI,EAAE,GAAG;YAChC,IAAI,GAAG,CAAC,IAAI,KAAK,cAAc,EAAE;gBAC/B,OAAO;aACR;YAED,OAAO,gBAAgB,CAAC,IAAI,CAAC,CAAC;QAChC,CAAC;KACF,CAAC;AACJ,CAAC;AAZD,wBAYC;AAED;;;;GAIG;AACH,SAAS,gBAAgB,CAAC,IAAY;IACpC,OAAO,IAAI,CAAC,OAAO,CACjB,SAAS,EACT;;;;;;;;;;;;;;;;;;;;GAoBD,CAAC,IAAI,EAAE,CACP,CAAC;AACJ,CAAC","sourcesContent":["import type { Plugin } from 'vite';\n\n/**\n * This plugin is a workaround to inject some styles into the `<head>` of the iframe to\n * prevent the \"no story\" text from appearing breifly while the page loads in.\n *\n * It can be removed, and these styles placed back into the head,\n * when https://github.com/vitejs/vite/issues/6737 is closed.\n */\nexport function noFouc(): Plugin {\n  return {\n    name: 'no-fouc',\n    enforce: 'post',\n    async transformIndexHtml(html, ctx) {\n      if (ctx.path !== '/iframe.html') {\n        return;\n      }\n\n      return insertHeadStyles(html);\n    },\n  };\n}\n\n/**\n * Insert default styles to hide storybook elements as the page loads until JS can\n * add the official storybook default head styles and scripts.  These lines are mostly\n * taken from https://github.com/storybookjs/storybook/blob/next/lib/core-common/templates/base-preview-head.html#L6-L20\n */\nfunction insertHeadStyles(html: string) {\n  return html.replace(\n    '</head>',\n    `\n  <style>\n    .sb-show-preparing-story:not(.sb-show-main) > :not(.sb-preparing-story) {\n      display: none;\n    }\n    .sb-show-preparing-docs:not(.sb-show-main) > :not(.sb-preparing-docs) {\n      display: none;\n    }\n    :not(.sb-show-preparing-story) > .sb-preparing-story,\n    :not(.sb-show-preparing-docs) > .sb-preparing-docs,\n    :not(.sb-show-nopreview) > .sb-nopreview,\n    :not(.sb-show-errordisplay) > .sb-errordisplay {\n      display: none;\n    }\n    #root[hidden],\n    #docs-root[hidden] {\n      display: none !important;\n    }\n  </style>\n</head>\n  `.trim()\n  );\n}\n"]}
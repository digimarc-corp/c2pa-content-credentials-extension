{"version":3,"file":"animate-controller.js","sources":["src/animate-controller.ts"],"sourcesContent":["import {ReactiveControllerHost} from 'lit';\nimport {Animate, Options} from './animate.js';\n\nexport const controllerMap: WeakMap<ReactiveControllerHost, AnimateController> =\n  new WeakMap();\n\n/**\n * AnimateController can be used to provide default configuration options to all\n * `animate()` directives in a given component.\n *\n * It also provides control over all the `animate()` animations within a given\n * component, for example, `this.animateController.pause()` pauses all animations.\n */\nexport class AnimateController {\n  host: ReactiveControllerHost;\n  defaultOptions: Options;\n  startPaused = false;\n  disabled = false;\n  onComplete?: () => void;\n\n  constructor(\n    host: ReactiveControllerHost,\n    options: {\n      defaultOptions?: Options;\n      startPaused?: boolean;\n      disabled?: boolean;\n      onComplete?: () => void;\n    }\n  ) {\n    this.host = host;\n    this.defaultOptions = options.defaultOptions || {};\n    this.startPaused = !!options.startPaused;\n    this.disabled = !!options.disabled;\n    this.onComplete = options.onComplete;\n    controllerMap.set(this.host, this);\n  }\n\n  /**\n   * Set of active `animate()` directives in the host component\n   */\n  clients: Set<Animate> = new Set();\n\n  protected pendingComplete = false;\n\n  async add(animate: Animate) {\n    this.clients.add(animate);\n    if (this.startPaused) {\n      animate.webAnimation?.pause();\n    }\n    this.pendingComplete = true;\n    await animate.finished;\n    if (this.pendingComplete && !this.isAnimating) {\n      this.pendingComplete = false;\n      this.onComplete?.();\n    }\n  }\n\n  remove(animate: Animate) {\n    this.clients.delete(animate);\n  }\n\n  /**\n   * Pauses all animations running in the host component.\n   */\n  pause() {\n    this.clients.forEach((f) => f.webAnimation?.pause());\n  }\n\n  /**\n   * Plays all active animations in the host component.\n   */\n  play() {\n    this.clients.forEach((f) => f.webAnimation?.play());\n  }\n\n  cancel() {\n    this.clients.forEach((f) => f.webAnimation?.cancel());\n    this.clients.clear();\n  }\n\n  finish() {\n    this.clients.forEach((f) => f.webAnimation?.finish());\n    this.clients.clear();\n  }\n\n  /**\n   * Toggles the play/pause state of all active `animate()` animations in the host component.\n   */\n  togglePlay() {\n    if (this.isPlaying) {\n      this.pause();\n    } else {\n      this.play();\n    }\n  }\n\n  /**\n   * Returns true if the host component has any active `animate()` animations.\n   */\n  get isAnimating() {\n    return this.clients.size > 0;\n  }\n\n  /**\n   * Returns true if the host component has any playing `animate()` animations.\n   */\n  get isPlaying() {\n    return Array.from(this.clients).some(\n      (a) => a.webAnimation?.playState === 'running'\n    );\n  }\n\n  async finished() {\n    await Promise.all(Array.from(this.clients).map((f) => f.finished));\n  }\n}\n"],"names":["controllerMap","WeakMap","AnimateController","constructor","host","options","this","Set","defaultOptions","startPaused","disabled","onComplete","set","async","animate","clients","add","webAnimation","pause","pendingComplete","finished","isAnimating","remove","delete","forEach","f","play","cancel","clear","finish","togglePlay","isPlaying","size","Array","from","some","a","playState","Promise","all","map"],"mappings":"MAGaA,EACX,IAAIC,cASOC,EAOXC,YACEC,EACAC,GANFC,kBAAc,EACdA,eAAW,EAuBXA,aAAwB,IAAIC,IAElBD,sBAAkB,EAb1BA,KAAKF,KAAOA,EACZE,KAAKE,eAAiBH,EAAQG,gBAAkB,GAChDF,KAAKG,cAAgBJ,EAAQI,YAC7BH,KAAKI,WAAaL,EAAQK,SAC1BJ,KAAKK,WAAaN,EAAQM,WAC1BX,EAAcY,IAAIN,KAAKF,KAAME,MAU/BO,UAAUC,WACRR,KAAKS,QAAQC,IAAIF,GACbR,KAAKG,wBACPK,EAAQG,6BAAcC,SAExBZ,KAAKa,iBAAkB,QACjBL,EAAQM,SACVd,KAAKa,kBAAoBb,KAAKe,cAChCf,KAAKa,iBAAkB,YACvBb,KAAKK,gCAALL,OAIJgB,OAAOR,GACLR,KAAKS,QAAQQ,OAAOT,GAMtBI,QACEZ,KAAKS,QAAQS,SAASC,UAAM,iBAAAA,EAAER,mCAAcC,WAM9CQ,OACEpB,KAAKS,QAAQS,SAASC,UAAM,iBAAAA,EAAER,mCAAcS,UAG9CC,SACErB,KAAKS,QAAQS,SAASC,UAAM,iBAAAA,EAAER,mCAAcU,YAC5CrB,KAAKS,QAAQa,QAGfC,SACEvB,KAAKS,QAAQS,SAASC,UAAM,iBAAAA,EAAER,mCAAcY,YAC5CvB,KAAKS,QAAQa,QAMfE,aACMxB,KAAKyB,UACPzB,KAAKY,QAELZ,KAAKoB,OAOLL,kBACF,OAAOf,KAAKS,QAAQiB,KAAO,EAMzBD,gBACF,OAAOE,MAAMC,KAAK5B,KAAKS,SAASoB,MAC7BC,UAAM,MAA8B,uBAA9BA,EAAEnB,mCAAcoB,cAI3BxB,uBACQyB,QAAQC,IAAIN,MAAMC,KAAK5B,KAAKS,SAASyB,KAAKf,GAAMA,EAAEL"}